"""
Тексты оферты Академического Салуна.
Короткая версия для быстрого принятия + полная версия по разделам.
"""
import random
from datetime import datetime
from zoneinfo import ZoneInfo


# ══════════════════════════════════════════════════════════════
#                    ПРИВЕТСТВИЯ ПО ВРЕМЕНИ СУТОК (МСК)
# ══════════════════════════════════════════════════════════════

MSK_TZ = ZoneInfo("Europe/Moscow")

# Короткие приветствия для "диалога" — bold + saloon style
GREETING_MORNING = "☀️ <b>Доброе утро в Салуне, {name}!</b>"
GREETING_DAY = "👋 <b>Приветствую в Салуне, {name}!</b>"
GREETING_EVENING = "🌅 <b>Добрый вечер в Салуне, {name}!</b>"
GREETING_NIGHT = "🌙 <b>Доброй ночи, {name}!</b>"

# Основной текст (компактный, с ценностью)
MAIN_USP_TEMPLATE = """Здесь всё по-честному: даёшь задачу — мы берём пыльную работу на себя.

🏆 <b>Наши регалии:</b>
├ 🤠 <b>6 лет</b> в деле
├ 👥 <b>1000+</b> довольных клиентов
└ {stats_line}

👇 <i>Садись за стойку — жми кнопку!</i>"""


def get_first_name(fullname: str | None) -> str:
    """Извлекает имя из полного имени"""
    if not fullname:
        return "странник"
    return fullname.split()[0]


def get_time_greeting(name: str = "странник") -> str:
    """
    Возвращает короткое приветствие по времени суток.
    """
    msk_hour = datetime.now(MSK_TZ).hour

    if 6 <= msk_hour < 12:
        return GREETING_MORNING.format(name=name)
    elif 12 <= msk_hour < 18:
        return GREETING_DAY.format(name=name)
    elif 18 <= msk_hour < 24:
        return GREETING_EVENING.format(name=name)
    else:
        return GREETING_NIGHT.format(name=name)


def get_main_text(
    stats_line: str = "",
    discount: int = 0,
) -> str:
    """
    Возвращает основной текст приветствия.
    """
    # Живая статистика или fallback
    if stats_line and stats_line.strip():
        live_stats = stats_line.strip()
    else:
        live_stats = "🔥 <b>Доводим до идеала</b>"

    # Базовый текст
    text = MAIN_USP_TEMPLATE.format(stats_line=live_stats)

    # Вставляем скидку перед CTA если есть
    if discount > 0:
        discount_line = f"🎁 Твоя скидка: <b>−{discount}%</b>\n\n"
        text = text.replace("\n👇", f"\n{discount_line}👇")

    return text.strip()


def get_welcome_quote() -> str:
    """Возвращает случайную цитату для подписи"""
    return f"\n\n<i>{random.choice(COWBOY_QUOTES)}</i>"


# Текст-интрига перед голосовым (с кнопкой)
VOICE_TEASER = """🤠 <b>Партнёр, у меня для тебя кое-что личное...</b>

Это не для всех — только для тех, кто в деле."""

# Подпись для голосового сообщения (caption прямо в голосовом)
VOICE_CAPTION = """🎙 <b>Голос Хозяина</b>

<i>Важная информация для новых партнёров</i>"""


# ══════════════════════════════════════════════════════════════
#                    СЛУЧАЙНЫЕ КОВБОЙСКИЕ ФРАЗЫ
# ══════════════════════════════════════════════════════════════

COWBOY_QUOTES = [
    "🌵 «Хороший ковбой всегда держит слово»",
    "🐎 «В этих краях дела делаются быстро и качественно»",
    "🎯 «Один выстрел — одна пятёрка»",
    "🤠 «Добро пожаловать, странник»",
    "⭐ «Шериф следит за порядком»",
    "🌅 «Закат красив, но дедлайн важнее»",
    "🔥 «У нас горячо — работа кипит»",
    "💨 «Быстрее ветра, точнее пули»",
    "🏜 «Через пустыню сессии — к оазису диплома»",
    "🎰 «С нами ты всегда в выигрыше»",
]


def get_random_quote() -> str:
    """Возвращает случайную ковбойскую фразу"""
    return random.choice(COWBOY_QUOTES)

# ══════════════════════════════════════════════════════════════
#                    КОРОТКАЯ ВЕРСИЯ (экран приветствия)
# ══════════════════════════════════════════════════════════════

TERMS_SHORT = """<b>📜 Кодекс Салуна</b>

Приветствую, партнёр. Здесь территория Шерифа. У нас всё чётко, но прежде чем начнём — ознакомься с правилами.

🎯 <b>Товар</b>
Мы готовим материалы (образцы, исходники). Как ты их будешь использовать в своём «учебном заведении» — сугубо твоя ответственность.

🔧 <b>Доработка</b>
Идеал — понятие растяжимое. У тебя есть <b>3 бесплатные корректировки</b>. Если мы накосячили или препод зверствует — поправим без вопросов.

🕵️‍♂️ <b>Чистая работа</b>
Никакого копипаста. Пишем с нуля под твои требования. В общие базы работ не сливаем — никто не узнает, что ты был здесь.

💰 <b>Сделка</b>
Работаем честно:
1. 50% аванс — мы начинаем копать.
2. По готовности присылаем <b>доказательства</b> (скрины, часть файла).
3. Ты кидаешь остаток — мы отдаём полный файл.

🤫 <b>Тайна</b>
Что было в Салуне — остаётся в Салуне.

<i>Жми кнопку ниже, если условия тебе подходят.</i>"""


# ══════════════════════════════════════════════════════════════
#                    ПОЛНАЯ ВЕРСИЯ (по разделам)
# ══════════════════════════════════════════════════════════════

TERMS_FULL_INTRO = """📜  <b>Полные условия</b>

Выбери раздел, чтобы прочитать подробнее:"""


TERMS_SECTION_1 = """📦  <b>Что мы делаем</b>


Академический Салун — сервис подготовки учебных материалов.

Мы создаём:
◈  Образцы научных и учебных работ
◈  Примеры оформления по стандартам
◈  Аналитические материалы по темам
◈  Справочные и методические пособия

<b>Важно понимать:</b>
Ты получаешь основу для самостоятельного изучения. Как именно использовать материалы — твоё личное решение и ответственность.

Мы не гарантируем приём работы третьими лицами (преподавателями, комиссиями). Качество делаем, но чужие решения не контролируем."""


TERMS_SECTION_2 = """🔧  <b>Правки и доработки</b>


<b>Три итерации бесплатно:</b>
◈  Уточнения по содержанию
◈  Исправления по замечаниям
◈  Дополнения в рамках ТЗ

Этого хватает в 95% случаев.

<b>Что считается новой задачей:</b>
◈  Смена темы работы
◈  Увеличение объёма более чем на 20%
◈  Новые требования после старта
◈  Изменение типа работы

Такие случаи обсуждаем отдельно — это честно для обеих сторон.

<b>Срок на проверку:</b>
После получения работы — 3 дня на замечания. Молчишь 3 дня — заказ считается принятым. Нужно больше времени — скажи заранее."""


TERMS_SECTION_3 = """🔍  <b>Про антиплагиат</b>


Мы <b>не проверяем</b> работу в антиплагиат-системах. И вот почему это тебе на пользу:

<b>Как работают вузовские системы:</b>
Они запоминают каждый проверенный текст. Если мы проверим до сдачи — твоя работа попадёт в базу. Когда загрузишь сам — система может пометить как дубликат.

<b>Наш подход:</b>
◈  Пишем качественно с нуля
◈  Оригинальность от 85%
◈  Не светим твой текст в системах
◈  Если после сдачи проблемы с % — бесплатно доработаем в течение недели

<b>Хочешь проверить сам?</b>
Text.ru, Content-Watch — эти сервисы безопасны, не сливают в вузовские базы."""


TERMS_SECTION_4 = """💰  <b>Оплата и возврат</b>


<b>Схема оплаты:</b>
50% аванс → выполнение → 50% после твоей проверки

<b>Возврат средств:</b>
◈  Отмена до начала работы — 100%
◈  Отмена в процессе — 50% (часть работы уже сделана)
◈  После получения готовой работы — возврат невозможен

<b>Не является основанием для возврата:</b>
◈  «Не понравился стиль»
◈  «Преподаватель не принял»
◈  «Оказалось нужно по-другому»

Все детали обсуждай до начала работы — тогда результат будет именно таким, как нужно.

<b>Баланс в Салуне:</b>
Бонусы за рефералов и компенсации копятся на балансе. Можно тратить на свои заказы."""


TERMS_SECTION_5 = """⏰  <b>Сроки</b>


<b>Отсчёт срока начинается:</b>
С момента оплаты аванса И получения всех материалов от тебя (методички, требования, примеры).

<b>Наши обязательства:</b>
Задержка более 3 дней по нашей вине — скидка 15% или полный возврат на твой выбор.

<b>Твоя зона ответственности:</b>
◈  Дать полное и чёткое ТЗ
◈  Предоставить нужные материалы
◈  Отвечать на уточняющие вопросы

Диплом за 2 дня не будет шедевром. Сложные работы требуют времени — закладывай запас."""


TERMS_SECTION_6 = """🔒  <b>Конфиденциальность</b>


<b>Мы гарантируем:</b>
◈  Не передаём твои данные третьим лицам
◈  Не публикуем выполненные работы
◈  Не продаём и не перепродаём материалы
◈  Не храним данные дольше необходимого

<b>Что в Салуне — остаётся в Салуне.</b>

Переписка, детали заказа, личная информация — всё под защитой. Мы дорожим репутацией и твоим доверием."""


TERMS_SECTION_7 = """⚖️  <b>Ограничение ответственности</b>


<b>Мы делаем:</b>
◈  Качественные материалы по твоему ТЗ
◈  Работу в согласованные сроки
◈  Доработки в рамках договорённостей

<b>Мы не контролируем:</b>
◈  Решения преподавателей и комиссий
◈  Требования, о которых ты не сообщил
◈  Изменения в правилах вуза после старта

<b>Форс-мажор:</b>
Технические сбои, блокировки, обстоятельства непреодолимой силы — решаем индивидуально, находим компромисс.

<b>Принимая условия, ты подтверждаешь:</b>
◈  Тебе есть 18 лет
◈  Ты понимаешь характер услуги
◈  Ты согласен с правилами Салуна"""


# ══════════════════════════════════════════════════════════════
#                    СЛОВАРЬ РАЗДЕЛОВ
# ══════════════════════════════════════════════════════════════

TERMS_SECTIONS = {
    "service": ("📦 Что мы делаем", TERMS_SECTION_1),
    "revisions": ("🔧 Правки", TERMS_SECTION_2),
    "antiplagiat": ("🔍 Антиплагиат", TERMS_SECTION_3),
    "payment": ("💰 Оплата", TERMS_SECTION_4),
    "deadlines": ("⏰ Сроки", TERMS_SECTION_5),
    "privacy": ("🔒 Конфиденциальность", TERMS_SECTION_6),
    "liability": ("⚖️ Ответственность", TERMS_SECTION_7),
}


# ══════════════════════════════════════════════════════════════
#                    СООБЩЕНИЕ ПОСЛЕ ПРИНЯТИЯ
# ══════════════════════════════════════════════════════════════

TERMS_ACCEPTED = """✅  <b>Добро пожаловать в Салун, {name}!</b>

Условия приняты. Теперь ты полноправный партнёр.

Если привёл друг — на первый заказ скидка <b>5%</b>.

<i>Выбирай, чем могу помочь:</i>"""

TERMS_ACCEPTED_RETURNING = """🍸  <b>С возвращением, {name}!</b>

{status}
{discount_line}

<i>Чем могу помочь?</i>"""
